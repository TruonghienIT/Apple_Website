<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="utf-8"/>
    <meta content="width=device-width, initial-scale=1" name="viewport"/>
    <title>
        Cửa Hàng Apple
    </title>
    <script src="https://cdn.tailwindcss.com">
    </script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css" rel="stylesheet"/>
    <link href="https://fonts.googleapis.com/css2?family=SF+Pro+Text:wght@400;600&amp;display=swap" rel="stylesheet"/>
    <style>
        body {
        font-family: "SF Pro Text", -apple-system, BlinkMacSystemFont,
            "Segoe UI", Roboto, Oxygen, Ubuntu, Cantarell, "Open Sans",
            "Helvetica Neue", sans-serif;
        }
        header {
            position: sticky;
            top: 0;  /* Đảm bảo header ở trên cùng */
            background-color:rgba(255, 255, 255, 0.7);  /* Thêm màu nền để dễ nhìn */
            z-index: 1000;  /* Đảm bảo header hiển thị trên các phần tử khác */
            width: 100%;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);  /* Tạo bóng mờ cho header */
        }
    </style>
</head>
<body class="bg-[#f5f7f7] text-black">
  <header class="w-full flex justify-center px-4 py-2 text-[20px] text-black/80">
    <nav>
      <ul class="flex items-center justify-center flex-wrap gap-4 sm:gap-6 relative">
        <!-- Logo -->
        <li>
          <a class="flex items-center" href="trangchu.html">
            <img alt="Apple logo black" class="block" height="45" src="Image/logo.png" width="41" />
          </a>
        </li>

        <!-- Các menu chính -->
        <li><a class="hover:underline" href="Main.html">Cửa Hàng</a></li>
        <li class="relative group">
          <a class="hover:underline cursor-pointer" href="Mac.html">Mac</a>
          <ul class="absolute left-0 hidden group-hover:flex flex-col bg-white border rounded-md shadow-md text-black w-40 z-10 transition-all duration-200">
            <li><a href="Mac.html#MacbookAir" class="block px-4 py-2 hover:bg-gray-100">Macbook Air</a></li>
            <li><a href="Mac.html#MacbookPro" class="block px-4 py-2 hover:bg-gray-100">Macbook Pro</a></li>
          </ul> 
        </li>

        <li class="relative group">
          <a class="hover:underline cursor-pointer" href="iPad.html">iPad</a>
          <ul class="absolute left-0 hidden group-hover:flex flex-col bg-white border rounded-md shadow-md text-black w-40 z-10 transition-all duration-200">
            <li><a href="iPad.html#iPadPro" class="block px-4 py-2 hover:bg-gray-100">iPad Pro </a></li>
            <li><a href="iPad.html#iPadAir" class="block px-4 py-2 hover:bg-gray-100">iPad Air</a></li>
            <li><a href="iPad.html#iPadMini" class="block px-4 py-2 hover:bg-gray-100">iPad Mini</a></li>
            <li><a href="iPad.html#iPadGen" class="block px-4 py-2 hover:bg-gray-100">iPad Gen</a></li>
          </ul> 
        </li>

        <li class="group relative">
          <a class="hover:underline cursor-pointer" href="iPhone.html">iPhone</a>
          <ul class="absolute left-0 hidden group-hover:flex flex-col bg-white border rounded-md shadow-md text-black w-40 z-10 transition-all duration-200">
            <li><a href="iPhone.html#iPhone15" class="block px-4 py-2 hover:bg-gray-100">iPhone 15</a></li>
            <li><a href="iPhone.html#iPhone14" class="block px-4 py-2 hover:bg-gray-100">iPhone 14</a></li>
            <li><a href="iPhone.html#iPhone13" class="block px-4 py-2 hover:bg-gray-100">iPhone 13</a></li>
            <li><a href="iPhone.html#iPhone12" class="block px-4 py-2 hover:bg-gray-100">iPhone 12</a></li>
            <li><a href="iPhone.html#iPhone11" class="block px-4 py-2 hover:bg-gray-100">iPhone 11</a></li>
          </ul>
        </li>

        <li class="group relative">
          <a class="hover:underline cursor-pointer" href="Watch.html">Watch</a>
          <ul class="absolute left-0 hidden group-hover:flex flex-col bg-white border rounded-md shadow-md text-black w-40 z-10 transition-all duration-200">
            <li><a href="Watch.html#WatchSeries" class="block px-4 py-2 hover:bg-gray-100">Apple Watch Series</a></li>
            <li><a href="Watch.html#WatchSE" class="block px-4 py-2 hover:bg-gray-100">Apple Watch SE</a></li>
            <li><a href="Watch.html#WatchUltra" class="block px-4 py-2 hover:bg-gray-100">Apple Watch Ultra</a></li>
          </ul>
        </li>

        <li class="group relative">
          <a class="hover:underline cursor-pointer" href="AirPods.html">AirPods</a>
          <ul class="absolute left-0 hidden group-hover:flex flex-col bg-white border rounded-md shadow-md text-black w-40 z-10 transition-all duration-200">
            <li><a href="AirPods.html#AirPods" class="block px-4 py-2 hover:bg-gray-100">AirPods</a></li>
            <li><a href="AirPods.html#AirPodsPro" class="block px-4 py-2 hover:bg-gray-100">AirPods Pro</a></li>
            <li><a href="AirPods.html#AirPodsMax" class="block px-4 py-2 hover:bg-gray-100">AirPods Max</a></li>
          </ul>
        </li>
        <li><a class="hover:underline" href="TV&Nha.html">TV &amp; Nhà</a></li>
        <li><a class="hover:underline" href="Giaitri.html">Giải Trí</a></li>
        <li><a class="hover:underline" href="Phukien.html">Phụ Kiện</a></li>
        <li><a class="hover:underline" href="Hotro.html">Hỗ Trợ</a></li>
      </ul>
    </nav>

    <!-- Tìm kiếm và đăng nhập -->
    <div class="hidden md:flex items-center space-x-4 text-gray-700 ml-6">
      <!-- Nút tìm kiếm -->
      <button 
        aria-label="Search" 
        class="hover:text-black" 
        onclick="toggleSearchForm()"
      >
        <i class="fas fa-search"></i>
      </button>

      <!-- Form tìm kiếm -->
      <div id="searchForm" class="hidden mt-4 w-full max-w-sm mx-auto">
        <form class="flex items-center" onsubmit="searchProduct(event)">
          <input 
            id="searchInput"
            type="text" 
            placeholder="Tìm kiếm sản phẩm..." 
            class="w-full px-3 py-2 text-sm text-black focus:outline-none" 
          />
          <button type="submit" class="bg-black text-white px-3 py-2 text-sm hover:bg-gray-800">
            Tìm
          </button>
        </form>
      </div>

      <!-- Icon người dùng -->
      <a href="profile.html">
        <button aria-label="User account" class="hover:text-black">
          <i class="fas fa-user"></i>
        </button>
      </a>
    </div>

    <div id="searchResults" class="mt-2 border p-4 rounded bg-white hidden relative">
      <button 
        onclick="closeSearchResults()" 
        class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 font-bold"
        aria-label="Đóng kết quả tìm kiếm"
      >
        &times;
      </button>
      <div id="searchResultsContent" class="flex space-x-4 overflow-x-auto max-w-full"></div>
    </div>

    <!-- Script toggle -->
    <script>
      function toggleSearchForm() {
          const form = document.getElementById('searchForm');
          form.classList.toggle('hidden');
      }

      // Hàm xử lý tìm kiếm sản phẩm
      function searchProduct(event) {
        event.preventDefault();

        const query = document.getElementById('searchInput').value;
        const resultsDiv = document.getElementById('searchResults');
        const resultsContent = document.getElementById('searchResultsContent');

        resultsDiv.classList.remove('hidden');
        resultsContent.innerHTML = "Đang tìm kiếm...";

        fetch('../backend/search.php?query=' + encodeURIComponent(query))
            .then(response => response.text())
            .then(data => {
                resultsContent.innerHTML = data;
            })
            .catch(error => {
                resultsContent.innerHTML = "Đã xảy ra lỗi khi tìm kiếm.";
                console.error("Lỗi:", error);
            });
          }

          // Hàm ẩn kết quả tìm kiếm khi bấm nút đóng
          function closeSearchResults() {
              const resultsDiv = document.getElementById('searchResults');
              resultsDiv.classList.add('hidden');
              // Nếu muốn, xóa nội dung cũ
              document.getElementById('searchResultsContent').innerHTML = "";
          }
      </script>
</header>
  <main>
    <div style="display: flex; justify-content: center; align-items: center; height: 20vh;">
        <h1 style="font-size: 110px; font-weight: 800; color: black;">Phụ kiện Apple</h1>
        <br>
    </div>
    <div class="max-w-[1200px] mx-auto px-4 py-4 grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-1 gap-4">
      <img src="Image/phụ kiện/panel.png" alt="Panel phụ kiện" class="mt-2 rounded-xl">
    </div>
    <br>
    <br>

    <section class="max-w-[1200px] mx-auto px-4 py-8">
  <h2 class="text-4xl font-semibold text-center text-gray-1000 mb-4">
    Tìm phụ kiện mong muốn.
  </h2>

  <!-- Search -->
  <div class="flex justify-center mb-4">
    <div class="relative w-full max-w-xl">
      <span class="absolute inset-y-0 left-0 pl-3 flex items-center text-gray-400">
        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
          <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                d="M21 21l-4.35-4.35m0 0A7.5 7.5 0 103.5 3.5a7.5 7.5 0 0013.15 13.15z" />
        </svg>
      </span>
      <input type="text" placeholder="Hãy cho tôi biết bạn cần gì?"
            class="w-full border border-gray-300 rounded-lg pl-10 pr-4 py-3 focus:outline-none focus:ring-2 focus:ring-pink-400 focus:border-transparent">
    </div>
  </div>

  <!-- Add Button -->
  <div class="flex justify-end mb-4">
    <button id="btnOpenAdd">
    </button>
  </div>

<div id="accessoryList" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-4 gap-4"></div>

</section>  
    <div id="addproductModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center hidden">
      <div class="bg-white p-6 rounded-xl w-full max-w-md">
        <h3 class="text-xl font-semibold mb-4" id="modalTitle">Thêm phụ kiện</h3>
        
        <form id="productForm" class="space-y-5" enctype="multipart/form-data">
          <input type="hidden" id="editIndex" name="editIndex" value="">

          <!-- Danh mục -->
          <div>
            <label for="category" class="block font-medium">Danh mục</label>
            <input type="text" id="category" name="category" value="Phụ kiện" readonly
              class="w-full border px-3 py-2 rounded bg-gray-100 cursor-not-allowed" />
          </div>

          <!-- Loại -->
          <div>
            <label for="subcategory" class="block font-medium mb-1">Loại phụ kiện<span class="text-red-600">*</span></label>
            <select id="subcategory" name="subcategory"
              class="w-full border border-gray-300 px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-green-600"
              required>
              <option value="">Chọn loại</option>
              <option value="Macbook Air">Cáp sạc</option>
              <option value="Macbook Pro">Ốp lưng</option>
              <option value="Macbook Pro">Apple Pencil</option>
              <option value="Macbook Pro">Cáp chuyển đổi</option>
              <option value="Macbook Pro">Dây đồng hồ</option>
            </select>
          </div>

          <!-- Tên sản phẩm -->
          <div>
            <label for="name" class="block font-medium mb-1">Tên sản phẩm <span class="text-red-600">*</span></label>
            <input type="text" id="name" name="name" required
              class="w-full border border-gray-300 px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-green-600" />
          </div>

          <!-- Mô tả -->
          <div>
            <label for="description" class="block font-medium mb-1">Mô tả</label>
            <textarea id="description" name="description" rows="3"
              class="w-full border border-gray-300 px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-green-600"></textarea>
          </div>

          <!-- Giá -->
          <div class="grid grid-cols-2 gap-4">
            <div>
              <label for="price" class="block font-medium mb-1">Giá gốc <span class="text-red-600">*</span></label>
              <input type="number" id="price" name="price" step="0.01" required
                class="w-full border border-gray-300 px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-green-600" />
            </div>
            <div>
              <label for="discount_price" class="block font-medium mb-1">Giá khuyến mãi</label>
              <input type="number" id="discount_price" name="discount_price" step="0.01"
                class="w-full border border-gray-300 px-3 py-2 rounded focus:outline-none focus:ring-2 focus:ring-green-600" />
            </div>
          </div>

          <!-- Ảnh sản phẩm -->
          <div>
            <label for="productImage" class="block font-medium mb-1">Ảnh sản phẩm <span class="text-red-600">*</span></label>
            <input type="file" id="productImage" name="productImage" accept="image/*" required
              class="w-full border border-gray-300 rounded px-2 py-1 focus:outline-none focus:ring-2 focus:ring-green-600" />
          </div>
          <!-- Buttons -->
          <div class="pt-4 flex justify-end space-x-3">
            <button type="submit"
              class="bg-[#2a5f4d] hover:bg-[#244d3f] text-white px-5 py-2 rounded">Lưu</button>
            <button type="button" id="btnCloseForm"
              class="border border-gray-300 px-5 py-2 rounded hover:bg-gray-200">Đóng</button>
          </div>
        </form>
      </div>
    </div>

    <!-- Modal chi tiết sản phẩm -->
    <div id="productModal" class="fixed top-0 left-0 w-full h-full bg-black bg-opacity-50 flex items-center justify-center hidden z-50">
      <div class="bg-white rounded-xl p-6 w-[90%] max-w-[600px] relative text-center">
        <span class="absolute top-3 right-4 text-3xl cursor-pointer" onclick="closeModal()">&times;</span>
        <h2 id="modalName" class="text-xl font-bold mb-3"></h2>
        <img id="modalImage" src="" alt="Sản phẩm" class="w-[250px] mx-auto mb-4 rounded-lg">
        <p id="modalPrice" class="text-lg font-semibold text-red-600 mb-2"></p>
        <p id="modalDescription" class="text-sm text-gray-700 leading-relaxed mb-4 text-left"></p>
        <button id="addToCartBtn" data-product-id=""
          onclick="addToCart()"
          class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">
          Thêm vào giỏ hàng
        </button>
      </div>
    </div>

    </section>
        <hr class="my-8 border-t border-gray-300" />
        <section class="max-w-[1200px] mx-auto px-4 py-8">
        <h2 class="text-2xl font-bold mb-4">Phụ kiện chính hãng là gì?</h2>
        <p align="justify" class="mb-6">
          Phụ kiện chính hãng là hàng được sản xuất bởi chính doanh nghiệp cung cấp hoặc do doanh nghiệp đối tác sản xuất theo hợp đồng đơn đặt hàng và được 
          bán thông qua các kênh đại lý hoặc nhà phân phối. Những loại phụ kiện chính hãng này thường được làm giả rất nhiều do chất lượng phụ kiện cao tương 
          ứng với giá thành tương đối mắc. Vì vậy, nhiều nơi sẽ làm giả nhái sản phẩm và bán với mức giá như hàng thật nhằm thu được chênh lệch lớn. Để có một  
          đảm bảo chất lượng và thời gian sử dụng lâu dài, bạn cần tìm đến những địa chỉ uy tín, bán phụ kiện chính hãng để mua hàng.
        </p>
        <h2 class="text-2xl font-bold mb-4">Tại sao phụ kiện dành cho các thiết bị điện tử lại cần thiết?</h2>
        <ul class="list-disc pl-6 space-y-1">
          <li align="justify">Một số loại phụ kiện như ốp lưng hay cường lực đảm nhiệm chức năng bảo vệ, chống trầy xước, méo mó hay vỡ cho các thiết bị. Giúp thiết bị điện tử bền bỉ với thời gian.</li>
          <li>Phụ kiện cũng góp phần tôn thêm vẻ đẹp của thiết bị điện tử, mang lại sự thời thượng, thể hiện được cá tính độc đáo của người dùng.</li>
          <li>Nhiều loại mang tính di động cao, dễ dàng mang theo bên mình khi di chuyển.</li>
          <li>Những chiếc dây đồng hồ màu sắc, chiếc ốp lưng xinh xắn hay tai nghe BlueTooth sang trọng, tất cả đều sẽ tô thắm thêm vẻ ngoài phong cách của người sử dụng chúng.</li>
          <li>Những phụ kiện âm thanh như loa hay tai nghe mang đến những trải nghiệm nghe nhạc, xem phim,… thêm phần ấn tượng, mượt mà..</li>
        </ul>
    </section>
  </main>
   <hr>
   <footer class="bg-black text-white text-[15px] font-sans rounded-t-2xl">
      <div class="max-w-[1200px] mx-auto px-4 py-8 grid grid-cols-1 sm:grid-cols-2 md:grid-cols-4 gap-6">
        <div>
          <h3 class="font-semibold mb-2">Sản phẩm</h3>
          <ul class="space-y-1">
            <li>
              <a href="iPhone.html">Iphone</a>
            </li>
            <li>
              <a href="Mac.html">IMac</a>
            </li>
            <li>
              <a href="iPad.html">IPad</a>
            </li>
            <li>
              <a href="Watch.html">Apple Watch</a>
            </li>
            <li>
              <a href="AirPods.html">AirPods</a>
            </li>
            <li>
              <a href="Phukien.html">Phụ Kiện</a>
            </li>
            <li>
              <a href="TV&Nha.html">TV&Nha</a>
            </li>
            <li>
              <a href="Giaitri.html">Giải trí</a>
            </li>
          </ul>
        </div>
        <div>
          <h3 class="font-semibold mb-2">Thông tin liên hệ</h3>
          <ul class="space-y-1">
            <li>
              <a href="">Chăm sóc khách hàng</a>
            </li>
            <li>
              <a href="">Dịch vụ sửa chữa Trương Hiện Care</a>
            </li>
            <li>
              <a href="">Khách hàng doanh nghiệp</a>
            </li>
            <li>
              <a href="">Tuyển dụng</a>
            </li>
            <li>
              <a href="">Tra cứu bảo hành</a>
            </li>
          </ul>
        </div>
        <div>
          <a href="">
            <p class="font-semibold mb-2">Thanh toán miễn phí</p>
          </a>
          <a href="">
            <p class="font-semibold mb-2">Hình thức vận chuyển</p>
          </a>
        </div>
        <div>
          <p class="font-semibold mb-1">Tổng đài</p>
          <div class="bg-white text-black font-semibold rounded px-2 py-1 w-max mb-1 inline-block text-[14px]">
            0376834541
          </div>
          <p class="text-[10px] mb-3">(Từ 8h30 - 21h30)</p>
          <p class="font-semibold">Liên hệ với chúng tôi</p>
        </div>
      </div>
      <div class="max-w-[1200px] mx-auto px-4 pb-4 text-[10px] text-center font-sans">
        <p>
          © 2025. CÔNG TY CỔ PHẦN XÂY DỰNG VÀ ĐẦU TƯ THƯƠNG MẠI TRƯƠNG HIỆN IT.
        </p>
        <p>
          Địa chỉ: Số 87 Yên Xá, Phường Tân Triều, Quận Thanh Trì, Hà Nội.
          Điện thoại: +84.376.345.41. Chủ trách nhiệm nội dung: <span class="font-semibold">Trương Công Hiện.</span>
        </p>
      </div>
    </footer>
      <button aria-label="Chat ngay" id="chatToggle" class="fixed bottom-6 right-6 bg-[#2a5f4d] text-white text-[14px] font-semibold rounded-md px-4 py-2 flex items-center space-x-2 shadow-md hover:bg-[#244d3f] transition" type="button">
        <span>
        CHAT NGAY
        </span>
      </button> 

      <div id="chatBox" class="fixed bottom-20 right-6 w-80 bg-white rounded shadow-lg border border-gray-200 hidden z-50">
        <div class="bg-green-100 px-4 py-2 flex justify-between items-center rounded-t">
          <span class="text-green-800 font-semibold">LIÊN HỆ ĐỂ ĐƯỢC TƯ VẤN</span>
          <button id="chatClose" class="text-red-500 text-xl font-bold">–</button>
        </div>
        <div class="p-4 space-y-3">
          <a href="tel:0376834541" class="flex items-center bg-gray-100 p-3 rounded hover:bg-gray-200">
            <img src="Image/tel.png" class="w-6 h-6 mr-2" />
            <span>Gọi 0376834541</span>
          </a>
          <a href="zalo.html" target="_blank" class="flex items-center bg-gray-100 p-3 rounded hover:bg-gray-200">
            <img src="Image/zalo.png" class="w-6 h-6 mr-2" />
            <span>Nhắn Zalo</span>
          </a>
          <a href="https://m.me/thanhhien110919" target="_blank" class="flex items-center bg-gray-100 p-3 rounded hover:bg-gray-200">
            <img src="Image/message.png" class="w-6 h-6 mr-2" />
            <span>Nhắn Facebook Messenger</span>
          </a>
        </div>
      </div>
      <script>
              const toggleBtn = document.getElementById('chatToggle');
              const chatBox = document.getElementById('chatBox');
              const closeBtn = document.getElementById('chatClose');

              toggleBtn.addEventListener('click', () => {
                chatBox.classList.toggle('hidden');
              });

              closeBtn.addEventListener('click', () => {
                chatBox.classList.add('hidden');
              });
      </script>
      <!-- Modal Sửa sản phẩm -->
      <div id="editProductModal" class="hidden fixed inset-0 bg-black bg-opacity-40 flex items-center justify-center z-50">
        <div class="bg-white p-6 rounded shadow-lg w-[400px] max-w-full">
          <h3 class="text-xl font-semibold mb-4">Sửa sản phẩm</h3>

          <form id="editProductForm" class="space-y-4" enctype="multipart/form-data">
            <input type="hidden" id="editProductId" name="productId" />

            <label for="editName" class="block font-medium">Tên sản phẩm *</label>
            <input type="text" id="editName" name="name" required class="w-full border px-3 py-2 rounded" />

            <label for="editPrice" class="block font-medium">Giá gốc *</label>
            <input type="number" id="editPrice" name="price" step="0.01" required class="w-full border px-3 py-2 rounded" />

            <label for="editDiscountPrice" class="block font-medium">Giá khuyến mại</label>
            <input type="number" id="editDiscountPrice" name="discount_price" step="0.01" class="w-full border px-3 py-2 rounded" />

            <label for="editDescription" class="block font-medium">Mô tả</label>
            <textarea id="editDescription" name="description" class="w-full border px-3 py-2 rounded"></textarea>

            <div class="pt-4 flex justify-end space-x-2">
              <button type="button" id="btnSaveEdit" class="bg-[#2a5f4d] text-white px-4 py-2 rounded hover:bg-[#244d3f]">Lưu</button>
              <button type="button" id="btnCloseEditForm" class="px-4 py-2 border rounded hover:bg-gray-200">Đóng</button>
            </div>

            <div id="confirmEditSection" class="hidden mt-4 bg-red-100 p-4 rounded text-red-800">
              <p id="confirmEditText" class="mb-3 font-semibold">Bạn có chắc chắn muốn lưu thay đổi không?</p>
              <button type="button" id="btnConfirmEditYes" class="bg-red-600 text-white px-4 py-1 rounded hover:bg-red-700">Có</button>
              <button type="button" id="btnConfirmEditNo" class="border border-red-200 text-red-700 px-4 py-1 rounded hover:bg-red-200">Không</button>
            </div>
          </form>
        </div>
      </div>


      <script>
        const backendBaseURL = "http://localhost/Web%20Apple/backend";

        // --- Modal Thêm sản phẩm ---
        const addModal = document.getElementById("addproductModal");
        const btnOpenAdd = document.getElementById("btnOpenAdd");
        const btnCloseAdd = document.getElementById("btnCloseForm");
        const addForm = document.getElementById("productForm");

        btnOpenAdd.addEventListener("click", () => {
          addForm.reset();
          addModal.classList.remove("hidden");
        });

        btnCloseAdd.addEventListener("click", () => {
          addModal.classList.add("hidden");
        });

        addForm.addEventListener("submit", async (e) => {
          e.preventDefault();
          const formData = new FormData(addForm);

          try {
            const response = await fetch(`${backendBaseURL}/add_product.php`, {
              method: "POST",
              body: formData,
            });

            const result = await response.json();

            if (result.success) {
              alert("Thêm phụ kiện thành công!");
              addModal.classList.add("hidden");
              addForm.reset();
              loadAccessories();
            } else {
              alert("Lỗi khi thêm phụ kiện: " + (result.message || "Không rõ lỗi"));
            }
          } catch (error) {
            console.error("Lỗi khi gửi form:", error);
            alert("Lỗi kết nối đến máy chủ, vui lòng thử lại.");
          }
        });

        // --- Modal Sửa sản phẩm ---
        const editModal = document.getElementById("editProductModal");
        const editForm = document.getElementById("editProductForm");
        const btnSaveEdit = document.getElementById("btnSaveEdit");
        const btnCloseEditForm = document.getElementById("btnCloseEditForm");
        const confirmSection = document.getElementById("confirmEditSection");
        const btnConfirmEditYes = document.getElementById("btnConfirmEditYes");
        const btnConfirmEditNo = document.getElementById("btnConfirmEditNo");

        let editProductPayload = null;

        function openEditModal(product) {
          document.getElementById("editProductId").value = product.id || "";
          document.getElementById("editName").value = product.name || "";
          document.getElementById("editPrice").value = product.price || "";
          document.getElementById("editDiscountPrice").value = product.discount_price || "";
          document.getElementById("editDescription").value = product.description || "";

          confirmSection.classList.add("hidden");
          editModal.classList.remove("hidden");
          editProductPayload = null;
        }

        btnCloseEditForm.addEventListener("click", () => {
          editModal.classList.add("hidden");
          confirmSection.classList.add("hidden");
          editProductPayload = null;
        });

        btnSaveEdit.addEventListener("click", () => {
          const productId = document.getElementById("editProductId").value.trim();
          const name = document.getElementById("editName").value.trim();
          const price = parseFloat(document.getElementById("editPrice").value);
          const discount_price = parseFloat(document.getElementById("editDiscountPrice").value) || 0;
          const description = document.getElementById("editDescription").value.trim();

          if (!productId || !name || isNaN(price)) {
            alert("Vui lòng điền đầy đủ thông tin sản phẩm hợp lệ.");
            return;
          }

          editProductPayload = { productId, name, price, discount_price, description };
          confirmSection.classList.remove("hidden");
        });

        btnConfirmEditNo.addEventListener("click", () => {
          confirmSection.classList.add("hidden");
          editProductPayload = null;
        });

        btnConfirmEditYes.addEventListener("click", async () => {
          if (!editProductPayload) return;

          try {
            const response = await fetch(`${backendBaseURL}/update_product.php`, {
              method: "POST",
              headers: { "Content-Type": "application/json" },
              body: JSON.stringify(editProductPayload),
            });

            const result = await response.json();

            if (result.success) {
              alert("Cập nhật sản phẩm thành công!");
              editModal.classList.add("hidden");
              editForm.reset();
              loadAccessories();
            } else {
              alert("Cập nhật thất bại: " + (result.message || "Không rõ lỗi"));
            }
          } catch (error) {
            console.error("Lỗi khi cập nhật sản phẩm:", error);
            alert("Lỗi kết nối máy chủ, vui lòng thử lại.");
          } finally {
            confirmSection.classList.add("hidden");
            editProductPayload = null;
          }
        });

        // --- Xóa sản phẩm ---
        async function deleteProduct(productId, productName) {
          if (confirm(`Bạn có chắc chắn muốn xóa sản phẩm "${productName}" không?`)) {
            try {
              const response = await fetch(`${backendBaseURL}/delete_product.php`, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify({ id: parseInt(productId) }),
              });

              const result = await response.json();
              if (result.success) {
                alert("Xóa thành công.");
                loadAccessories();
              } else {
                alert("Lỗi xóa: " + (result.message || "Không rõ lỗi."));
              }
            } catch (error) {
              console.error("Lỗi khi gọi API xóa:", error);
              alert("Lỗi kết nối đến máy chủ.");
            }
          }
        }

        function openAccessoryModal(product) {
        // Gán dữ liệu vào modal
        document.getElementById("modalName").textContent = product.name || "";
        document.getElementById("modalImage").src = product.image || "";
        document.getElementById("modalImage").alt = product.name || "Sản phẩm";
        document.getElementById('addToCartBtn').dataset.productId = product.id;
        
        if (product.discount_price > 0) {
          // Nếu có giá giảm thì hiển thị giá giảm, giá gốc gạch ngang (nếu muốn)
          document.getElementById("modalPrice").innerHTML = `
            <span class="text-red-600 font-bold">${Number(product.discount_price).toLocaleString("vi-VN")}₫</span>
            <span class="line-through text-gray-500 ml-2">${Number(product.price).toLocaleString("vi-VN")}₫</span>
          `;
        } else {
          document.getElementById("modalPrice").textContent = Number(product.price).toLocaleString("vi-VN") + "₫";
        }
        document.getElementById("modalDescription").innerHTML =
            `<strong>Mô tả:</strong> ${product.description || 'Chưa có mô tả.'}`;
        // Hiển thị modal
        document.getElementById("productModal").classList.remove("hidden");
      }
      function closeModal() {
        document.getElementById("productModal").classList.add("hidden");
      }
        // --- Load danh sách phụ kiện ---
        async function loadAccessories() {
          try {
            const res = await fetch(`${backendBaseURL}/get_product.php`);
            if (!res.ok) throw new Error("Lỗi khi tải dữ liệu sản phẩm");

            const data = await res.json();
            if (!data.success) throw new Error("Backend trả về lỗi: " + (data.message || ""));

            // Lọc sản phẩm thuộc category "Phụ kiện"
            const accessories = data.products.filter(
              (p) => p.category.toLowerCase() === "phụ kiện"
            );

            const container = document.getElementById("accessoryList");
            container.innerHTML = "";

            if (accessories.length === 0) {
              container.innerHTML = "<p>Chưa có phụ kiện nào.</p>";
              return;
            }

            accessories.forEach((product) => {
              const discountHtml =
                product.discount_price > 0
                  ? `<p class="text-red-600 text-lg font-bold">${Number(
                      product.discount_price
                    ).toLocaleString("vi-VN")}₫</p>
                    <p class="line-through text-yellow-500 text-sm">${Number(
                      product.price
                    ).toLocaleString("vi-VN")}₫</p>`
                  : `<p class="text-red-600 text-lg font-bold">${Number(
                      product.price
                    ).toLocaleString("vi-VN")}₫</p>`;

              const productHtml = `
                <div
                  class="relative rounded-2xl bg-black p-4 cursor-pointer flex flex-col items-center text-center"
                >
                  <img
                    src="${backendBaseURL}/${product.image}"
                    alt="${product.name}"
                    class="mt-2 rounded-xl max-h-40 object-contain product-image hover:scale-110 transition-transform duration-200"
                    data-id="${product.id}"
                    data-name="${product.name}"
                    data-price="${product.price}"
                    data-discount_price="${product.discount_price}"
                    data-description="${product.description || ""}"
                    data-category="${product.category}"
                  />
                  <h3 class="font-semibold text-sm mb-1 text-white">${product.name}</h3>
                  ${discountHtml}
                  

                </div>
              `;

              container.insertAdjacentHTML("beforeend", productHtml);
            });

            // <div class="mt-3 flex gap-2">
            //         <button
            //           class="edit-btn bg-yellow-500 hover:bg-yellow-600 text-white px-3 py-1 rounded text-sm"
            //           data-id="${product.id}"
            //           data-name="${product.name}"
            //           data-price="${product.price}"
            //           data-discount_price="${product.discount_price}"
            //           data-description="${product.description || ""}"
            //           data-category="${product.category}"
            //         >
            //           Sửa
            //         </button>
            //         <button
            //           class="delete-btn bg-red-600 hover:bg-red-700 text-white px-3 py-1 rounded text-sm"
            //           data-id="${product.id}"
            //           data-name="${product.name}"
            //         >
            //           Xóa
            //         </button>
            //       </div>

            // Gắn sự kiện click cho ảnh sản phẩm - mở modal chi tiết nếu có (bạn tự implement hàm openAccessoryModal)
            document.querySelectorAll(".product-image").forEach((img) => {
              img.addEventListener("click", (event) => {
                event.stopPropagation();
                const product = {
                  id: img.dataset.id,
                  name: img.dataset.name,
                  price: parseFloat(img.dataset.price),
                  discount_price: parseFloat(img.dataset.discount_price),
                  description: img.dataset.description,
                  category: img.dataset.category,
                  image: img.src,
                };
                if (typeof openAccessoryModal === "function") {
                  openAccessoryModal(product, backendBaseURL);
                }
              });
            });

            // Gắn sự kiện nút Sửa
            document.querySelectorAll(".edit-btn").forEach((button) => {
              button.addEventListener("click", () => {
                const product = {
                  id: button.dataset.id,
                  name: button.dataset.name,
                  price: button.dataset.price,
                  discount_price: button.dataset.discount_price,
                  description: button.dataset.description,
                  category: button.dataset.category,
                };
                openEditModal(product);
              });
            });

            // Gắn sự kiện nút Xóa
            document.querySelectorAll(".delete-btn").forEach((button) => {
              button.addEventListener("click", () => {
                const productId = button.getAttribute("data-id");
                const productName = button.getAttribute("data-name");
                deleteProduct(productId, productName);
              });
            });
          } catch (error) {
            console.error(error);
            alert("Lỗi tải phụ kiện, vui lòng thử lại.");
          }
        }

        window.addEventListener("DOMContentLoaded", loadAccessories);
      </script>

      <script>
        function addToCart() {
          const btn = document.getElementById('addToCartBtn');
          const productId = btn.dataset.productId;
          const quantity = 1;

          fetch('../backend/add_to_cart.php', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({
              product_id: productId,
              quantity: quantity
            })
          })
          .then(res => res.json())
          .then(data => {
            alert(data.message);
            if (data.success) closeModal();
          })
          .catch(err => {
            console.error("Lỗi:", err);
            alert("Đã xảy ra lỗi khi thêm vào giỏ hàng.");
          });
        }
      </script>
  </body>
</html>